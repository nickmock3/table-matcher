# 店舗詳細画面（公開ユーザー向け）実装計画

## 1. 対象仕様
- 仕様書: `docs/specs/features/store-detail-user.md`
- 対象範囲: `/stores/[storeId]` の詳細表示、地図表示領域、予約導線、バナー広告領域（仮置き）

## 2. 実装方針
- `src/app/stores/[storeId]/page.tsx` は画面エントリに留め、表示ロジックは `src/features/store-detail/` へ切り出す。
- 既存 `StoreRepository` を利用し、将来のDB/API差し替えに備えて依存を取得層へ集約する。
- 地図は失敗時フォールバックを前提に段階導入する（まず領域成立、次にAPI接続）。
- 広告は配信タグ導入前提のため、まず固定高さのプレースホルダー領域を配置する。

## 3. 成果物
- 店舗詳細表示コンポーネント
- 地図表示コンポーネント（フォールバック含む）
- 予約CTA（行動ボタン）コンポーネント
- 広告領域プレースホルダーコンポーネント
- 店舗詳細導線のE2E

## 4. 実装ステップ
1. 詳細画面のUI骨格を整備（情報表示、戻る導線、CTA（行動ボタン）、広告領域）。
2. `storeId` 解決と404処理を明確化。
3. 地図表示領域を追加し、失敗時フォールバックを実装。
4. Unitテストを追加（存在判定、表示モデル、フォールバック、広告プレースホルダー）。
5. E2Eを追加（一覧->詳細->戻る/予約、広告領域表示）。
6. lint + unit + e2e + build を実行してDoD確認。

## 5. テスト計画
- lint: `bun run lint`
- unit: `Vitest`（詳細表示モデル、`storeId` 解決、地図フォールバック、広告領域）
- e2e: `Playwright`（詳細主要導線、広告領域表示確認）

## 6. リスクと対策
- リスク: 地図APIの導入条件（APIキー、利用制限）でローカル検証が不安定。
- 対策: API非依存のフォールバックUIを先に実装し、E2Eは地図そのものではなく導線中心に検証。

## 7. 完了条件（DoD）
- `docs/specs/features/store-detail-user.md` の受け入れ条件を満たす。
- `spec + plan + tasks` の整合が取れている。
- `bun run lint` と関連unit、必要e2e、`bun run build` が通過している。
- AIレビューの主要指摘に対応済み。

## 8. 変更履歴
- 2026-02-13: 初版作成
- 2026-02-13: バナー広告領域（仮置き）追加方針を反映
