# 中間提出向けスモークE2E 実装計画

## 1. 対象仕様
- 仕様書（既存参照）:
  - `docs/specs/features/admin-store-management.md`
  - `docs/specs/features/store-user-image-management.md`
  - `docs/specs/features/store-detail-user.md`
- 対象範囲: 管理者操作 -> 店舗ユーザー操作 -> 公開画面反映の主要導線を1本のスモークE2Eで確認

## 2. 実装方針
- 既存E2E認可オーバーライド（`x-e2e-admin-role`, `x-e2e-shop-role`）を活用し、外部ログイン依存を避ける。
- 1シナリオ内で「管理者による店舗更新」「店舗ユーザー画像更新」「公開詳細で反映確認」を連続検証する。
- 既存の店舗ユーザー紐づき店舗を対象にし、更新した値（ジャンル・画像URL配列）は `finally` で復元する。
- スモーク用途のため、詳細網羅より「提出で説明する価値の高い1本」を優先する。

## 3. 成果物
- スモークE2E spec（1本）
- 必要最小限のテスト補助関数
- `tasks/` への実行コマンド・結果記録

## 4. 実装ステップ
1. 既存E2Eのヘッダー認可方式を流用し、スモークシナリオの土台を作成。
2. 店舗ユーザーとして対象店舗IDを取得し、同じ店舗を管理者画面で更新する。
3. 店舗ユーザー画像管理画面で画像アップロード/保存を実行。
4. 公開詳細画面で同一店舗の表示と画像反映を確認。
5. lint + unit（関連）+ e2e + build を実行し、結果を記録。

## 5. テスト計画
- lint: `bun run lint`
- unit: `bun run test`（関連範囲）
- e2e: `bun run e2e -- e2e/demo-smoke.spec.ts`（新規）
- build: `bun run build`

## 6. リスクと対策
- リスク: 1シナリオに依存関係が多く、失敗時に原因切り分けが難しい。
- 対策: 各フェーズ（管理者/店舗ユーザー/公開）で明確なアサーションを置き、失敗点を特定しやすくする。

- リスク: 画像アップロード結果が前後テストに影響する。
- 対策: 更新値を `finally` で復元し、既存店舗データへの恒久影響を残さない。

## 7. 完了条件（DoD）
- 中間提出で説明する主要導線を1本のE2Eで再現できる。
- `bun run lint` / 関連unit / `bun run e2e -- e2e/demo-smoke.spec.ts` / `bun run build` が通過する。
- `spec + plan + tasks` の参照整合が取れている。

## 8. 変更履歴
- 2026-02-26: 初版作成
- 2026-02-26: 実装に合わせて「既存紐づき店舗の更新+復元」方針へ更新
