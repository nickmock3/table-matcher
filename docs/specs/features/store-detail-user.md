# 店舗詳細画面（公開ユーザー向け）機能仕様書

## 概要
- 公開ユーザーが店舗の詳細情報を確認し、来店判断・予約行動に進める店舗詳細画面を提供する。
- 地図表示は店舗詳細画面で提供する。

## 背景・目的
- トップ画面の一覧情報だけでは来店判断に必要な情報が不足する。
- 店舗の場所・空席状況・予約導線を1画面で確認できるようにする。

## スコープ
### In scope
- 店舗詳細表示（店名、ジャンル、エリア、空席状態、最終更新）
- 地図表示領域（詳細画面内）
- バナー広告表示領域（仮置き）
- 外部予約URLへの導線
- 一覧画面への戻り導線
- 該当店舗なし時の404

### Out of scope
- ブックマーク/お気に入り機能
- 地図の高度操作（経路検索、現在地連動、周辺店舗比較）
- レビュー/口コミ機能

## ユーザーストーリー
- 公開ユーザー: 選択した店舗の場所と空席状況を確認して、予約に進みたい。
- 店舗ユーザー: 未対象。
- 管理者: 未対象。

## 画面・導線
- 対象画面: `src/app/stores/[storeId]/page.tsx`
- 遷移:
  - トップ/一覧から店舗カード選択
  - 店舗詳細画面表示
  - 外部予約URL遷移
  - 一覧へ戻る
- 入口/出口:
  - 入口: `/stores/[storeId]`
  - 出口: 外部予約URL / `/`

## 機能要件
1. URLパラメータ `storeId` に対応する店舗情報を表示できること。
2. 地図表示領域を詳細画面内に配置し、店舗位置を確認できること。
3. 空席状態を視認しやすい形式で表示すること。
4. 外部予約URLへのCTA（行動ボタン）を表示し、別タブ遷移できること。
5. 一覧へ戻る導線を常に提供すること。
6. 該当 `storeId` が存在しない場合、404を返すこと。
7. 詳細画面内にバナー広告領域（仮置き）を表示できること。

## 非機能要件
- 性能: 主要情報（店名/空席状態/CTA（行動ボタン））が初回表示で視認できること。
- 可用性: 地図表示失敗時も詳細情報と予約導線は利用可能にする。
- 運用: 広告配信未接続時でも広告領域をプレースホルダー表示し、レイアウトが崩れないこと。
- 運用上の制約: 地図APIキー管理・利用制限は別途設定手順に従う。

## データ要件
- 主なエンティティ: Store, VacancyStatus
- 保存項目:
  - Store: `id`, `name`, `genre`, `city`, `reservationUrl`, `imageUrl`
  - VacancyStatus: `vacancyStatus`, `updatedAt`
  - Map: `latitude`, `longitude`（MVPで未保有なら住所ベース表示を許容）
- バリデーション制約:
  - `storeId` は存在チェックを行う
  - `reservationUrl` はURL形式を満たす

## 権限・認可
- 誰が何をできるか: 公開ユーザーは閲覧・外部予約遷移のみ可能。
- 禁止操作: 公開ユーザーは店舗情報や空席情報の更新不可。

## エラー/例外ケース
- 入力エラー: `storeId` 不正時は404表示。
- 権限エラー: 公開画面のため基本なし。
- 外部API失敗: 地図API失敗時は地図領域をフォールバック表示し、他要素は継続。

## 受け入れ条件（Acceptance Criteria）
1. `/stores/[storeId]` で対象店舗情報が表示される。
2. 画面内に地図表示領域があり、店舗位置確認が可能である。
3. 外部予約CTA（行動ボタン）から予約URLへ遷移できる。
4. 一覧へ戻る導線が表示される。
5. 存在しない `storeId` では404となる。
6. 画面内にバナー広告領域（仮置き）が表示される。

## テスト観点
### Unit
- `storeId` 解決ロジック（存在/非存在）
- 詳細表示モデルの整形
- 地図表示フォールバック判定
- 広告領域プレースホルダー表示判定

### E2E（必要時のみ）
- 対象導線: `/` -> `/stores/[storeId]` -> 外部予約CTA（行動ボタン） / 一覧へ戻る
- 実施条件: 主要導線として実施

## 依存・前提
- 他機能依存: トップ一覧導線、店舗データ取得層
- 外部サービス依存: 地図表示API（候補: Google Maps）
- 先行タスク: 地図表示方式（埋め込み/静的マップ）の実装方針確定

## 未決定事項
- 地図表示方式（Google Maps埋め込み or Static Map画像）
- 外部予約リンク遷移仕様（新規タブ固定の是非）
- 広告ネットワーク選定と埋め込みタグ仕様

## 変更履歴
- 2026-02-13: 初版作成
- 2026-02-13: 店舗詳細画面にバナー広告領域（仮置き）要件を追加
