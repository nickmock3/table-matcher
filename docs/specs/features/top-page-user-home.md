# トップ画面（公開ユーザー向け）機能仕様書

## 概要
- 公開ユーザーが「今空いている店」を素早く見つけられるトップ画面を提供する。
- MVPではトップ画面を店舗一覧画面と兼用し、検索・絞り込み・店舗詳細への遷移を担う。

## 背景・目的
- 初回訪問ユーザーがサービス価値を短時間で理解できる入口が必要。
- MVPの主要導線（トップ -> 一覧確認 -> 店舗詳細）を最短で成立させる。

## スコープ
### In scope
- 公開トップ画面の情報設計（ヒーロー、検索導線、一覧導線）
- 「空席あり / なし」の状態表示ルール
- 一覧の基本並び順・絞り込みUIの要件
- 店舗詳細画面への遷移導線

### Out of scope
- 店舗ユーザー / 管理者向け画面の詳細仕様
- 地図表示の詳細UX（別仕様で定義）
- A/Bテスト、パーソナライズ、レコメンド

## ユーザーストーリー
- 公開ユーザー: 現在地やエリア条件から、空席のある店舗を優先して探したい。
- 店舗ユーザー: 未対象（本仕様では公開側トップ画面のみ扱う）。
- 管理者: 未対象（本仕様では公開側トップ画面のみ扱う）。

## 画面・導線
- 対象画面: `src/app/page.tsx`（公開トップ兼一覧）
- 遷移:
  - トップ画面表示
  - 条件指定（市区町村 / ジャンル / 空席のみ）
  - 店舗カード選択
  - 店舗詳細画面へ遷移（地図表示は詳細画面で提供）
- 入口/出口:
  - 入口: `/`
  - 出口: `/stores/[storeId]`（確定）

## 機能要件
1. ファーストビューでサービス価値（空席の即時確認ができる）を伝えること。
2. 検索条件として「市区町村」「ジャンル」「空席のみ」を指定できること。
3. 一覧は「空いている店 -> 空いていない店」、各グループ内は更新が新しい順で表示すること。
4. 各店舗カードに最低限の情報（店名、ジャンル、市区町村、空席状態、最終更新時刻、店舗詳細への導線）を表示すること。
5. 条件に一致する店舗が0件の場合、再検索を促す空状態UIを表示すること。
6. 検索UIの初期値は「空席のみ: ON」「市区町村: 未選択（全件）」「ジャンル: 未選択（全件）」とすること。

## 非機能要件
- 性能: モバイル3G相当でも初回表示体感を損ねない（LCP 2.5秒以内を目標値）。
- 可用性: `/api/health` が正常時はトップ画面が致命エラーなく描画される。
- 運用上の制約: MVPではSSR/ISR方針の最終決定は `plans/` で確定する。

## データ要件
- 主なエンティティ: Store, VacancyStatus, Genre
- 保存項目:
  - Store: 店名、住所、市区町村、ジャンル、外部予約URL
  - VacancyStatus: 空席状態、更新日時
- バリデーション制約:
  - 空席状態は `空いている / 空いていない` の2値
  - 更新日時はISO 8601形式で扱う
- 取得方式（MVP）:
  - 初期実装（TASK-TP-001）は固定モックデータで画面成立を優先する
  - 後続タスクで取得層を差し替え可能な構造にする

## 権限・認可
- 誰が何をできるか: 公開ユーザーは一覧閲覧・検索のみ可能。
- 禁止操作: 公開ユーザーは空席更新・店舗編集・管理操作不可。

## エラー/例外ケース
- 入力エラー: 検索条件が無効な場合はデフォルト条件にフォールバックし警告表示。
- 権限エラー: 公開画面のため基本なし。内部API失敗時は汎用エラー表示。
- 外部API失敗: 地図/外部予約URL連携失敗時も一覧閲覧は継続可能にする。

## 受け入れ条件（Acceptance Criteria）
1. ユーザーが `/` にアクセスすると、トップ画面としての訴求領域と店舗一覧領域が表示される。
2. 「市区町村 / ジャンル / 空席のみ」の条件変更で一覧結果が更新される。
3. 並び順が `空席あり優先 + 更新日時降順` を満たす。
4. 店舗カードから店舗詳細画面へ遷移できる。
5. 0件時に空状態UIと再検索導線が表示される。
6. 初期表示で「空席のみ」がONの状態で一覧が表示される。

## テスト観点
### Unit
- 並び順ロジック（空席優先 + 更新日時降順）
- 検索条件のバリデーション/正規化
- 空状態判定ロジック

### E2E（必要時のみ）
- 対象導線: `/` -> 条件指定 -> 店舗詳細遷移
- 実施条件: 主要導線としてMVP初期から実施

## 依存・前提
- 他機能依存: 店舗詳細画面仕様、店舗データ取得API仕様
- 外部サービス依存: なし（トップ画面描画自体は内部データのみで成立）
- 先行タスク: 店舗一覧取得ユースケース実装、Seedデータ整備

## 未決定事項
- 未ログイン時のブックマーク/お気に入り導線の有無

## 変更履歴
- 2026-02-12: 初版作成
- 2026-02-12: 店舗詳細URL、カード最小項目、検索初期値、MVPデータ取得方針を確定
- 2026-02-12: 地図表示位置を「店舗詳細画面で表示」に確定
