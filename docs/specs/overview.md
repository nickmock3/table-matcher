MVP仕様書

1. 画面構成
- 公開側（ユーザー）: 一覧（トップ兼用） / 店舗詳細
- 店舗ユーザー: ログイン / 空席情報の更新（自店舗のみ）
- 管理者: ログイン / 店舗登録・編集 / 設定 / ダッシュボード

2. 機能・ルール
- 空席情報: 空いている / 空いていない の2択
- 有効期限: 更新から30分固定
- 一覧並び順: 空いている店 → 空いていない店、各グループ内は更新が新しい順
- 検索: 市区町村 / ジャンル / 空席のみ
- 外部予約URL: 1店舗1本（MVP）
- 地図表示: あり

3. 認証・権限
- 管理者: 1名想定、Google認証、登録はDB直打ち
- 店舗ユーザー: Google認証
  - 管理者が店舗にログイン用メールアドレスを登録
  - そのGoogleアカウントのみ紐づけ可能
- 店舗ユーザー権限: 自店舗の空席情報のみ更新

4. ログ計測・集計
- 計測方式: 閲覧時に1ログ、離脱時に滞在時間送信（JS計測）
- 有効imp: 滞在時間が閾値以上のみカウント
- 有効滞在時間: 管理者設定（デフォルト5秒）
- Bot除外（固定）: 同一IP+UAの短時間連続 / webdriver・Headless UA
- 集計: JST、日別 + 月別

5. 分配・収益
- 分配比率: 曜日別に固定比率を設定（管理者設定）
- 単価: 有効impあたりの単価を1つだけ管理者設定
- ダッシュボード表示: 店舗別imp / 平均滞在時間 / 推定広告費 / 分配額（店舗・管理者）
- 月次精算CSV: 出力あり（店舗別合計）

6. 実装前提（インフラ・技術）
- 実行環境: Cloudflare WorkersでNext.jsを動かす
- DB: Cloudflare D1（ログはD1直保存、将来は月次でR2退避）
- 認証: Next.js + Better Auth、JWT+Cookie
- 地図: Google Maps
- 画像: R2にアップロード（1店舗 最大10枚、最低1枚）
- 住所→緯度経度: Google Geocoding API
- バッチ集計: Cloudflare Cron Triggers（日次・月次）
- CSV出力: 管理者画面から月次CSV出力
- 想定PV: 1,000/日未満（初期）
- ジャンル: 固定マスタ
